fix errors and correctly implement instruction set